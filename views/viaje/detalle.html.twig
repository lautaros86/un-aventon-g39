{% extends 'layoutPerfil.html.twig' %}
{% block title %}
    UnAventon - Viaje
{% endblock %}

{% block style %}
    {{ parent() }}
    <!-- iCheck -->
    <link rel="stylesheet" href="../../bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
    <!-- Bootstrap time Picker -->
    <link rel="stylesheet" href="../../bower_components/admin-lte/plugins/timepicker/bootstrap-timepicker.css">
    <style>
        #map {
            min-height: 260px;
            min-width: 430px;
        }
    </style>

{% endblock %} 
{% block boxPerfil %}
    <!-- Profile Image -->
    <div class="box box-primary">
        <div class="box-body box-profile">
            <img class="profile-user-img img-responsive img-circle" src="{% if chofer.foto %}{{chofer.foto}}{% else %}/img/anonimo.png{% endif %}" alt="User profile picture">
            <h3 class="profile-username text-center"> {{chofer.nombre}} {{chofer.apellido}}</h3>
            <p class="text-muted text-center">{{chofer.email}}</p>
            <ul class="list-group list-group-unbordered">
                <li class="list-group-item">
                    <b>Total de Viajes</b> <a class="pull-right">{{chofer.cantViajesChofer + chofer.cantViajesPasajero}}</a>
                </li>
                <li class="list-group-item">
                    <b>Como Chofer</b> <a class="pull-right">{{chofer.cantViajesChofer}}</a>
                </li>
                <li class="list-group-item">
                    <b>Pasajero</b> <a class="pull-right">{{chofer.cantViajesPasajero}}</a>
                </li>
                <li class="list-group-item">
                    <b>Reputacion</b> <a class="pull-right">{{chofer.reputacion}}</a>
                </li>
            </ul>

            <button class="btn btn-warning btn-block" id="postularseViaje"><b>CONSULTAR</b></button>
            <br/>
            <button class="btn btn-success btn-block" id="postularse "><b>POSTULARME</b></button>
        </div>
        <!-- /.box-body -->
    </div>
{% endblock %}
{% block subContenido %}

    <div class="box box-primary">
        <div class="box-body box-profile">
            <h3 class="profile-username text-center">Info general</h3>
            <p class="text-muted text-center">{{chofer.email}}</p>
            <ul class="list-group list-group-unbordered">
                <li class="list-group-item" id="detalleOrigen">
                    <b>Origen: </b>
                </li>
                <li class="list-group-item" id="detalleDestino">
                    <b>Origen: </b>
                </li>
                <li class="list-group-item" id="detalleKms">
                    <b>Kms: </b>
                </li>
            </ul>
            <div id="directions-panel"></div>

        </div>
        <!-- /.box-body -->

        <div class="box-header">
            <h3 class="box-title">Recorrido estimado</h3>
        </div>

        <div class="box-body">

            <div id="map"></div>

        </div>
    </div>
</div>



{% endblock %}

{% block script %}
    {{ parent() }}
    <script>
        function initMap() {
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 8,
                center: {lat: -34.91482928576744, lng: -57.94609843010255}
            });
            var geocoder = new google.maps.Geocoder();

            var directionsService = new google.maps.DirectionsService();
            var directionsDisplay = new google.maps.DirectionsRenderer();


            directionsDisplay.setMap(map);

            /* En caso de querer ver las indicaciones */
            directionsDisplay.setPanel($('#panel').html());

            var origen = "{{viaje.origen}}";
            var destino = "{{viaje.destino}}";
            calculateAndDisplayRoute(directionsService, directionsDisplay, origen, destino)
        }
        function geocodeAddress(geocoder, resultsMap) {
            var address = document.getElementById('address').value;
            geocoder.geocode({'address': address}, function (results, status) {
                if (status === 'OK') {
                    resultsMap.setCenter(results[0].geometry.location);
                    var marker = new google.maps.Marker({
                        map: resultsMap,
                        position: results[0].geometry.location
                    });
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }
        function calculateAndDisplayRoute(directionsService, directionsDisplay, origen, destino) {
            directionsService.route({
                origin: origen,
                destination: destino,
                optimizeWaypoints: true,
                travelMode: 'DRIVING'
            }, function (response, status) {
                if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                    var route = response.routes[0];
                    var summaryPanel = document.getElementById('directions-panel');
                    summaryPanel.innerHTML = '';
                    $("#detalleOrigen").append(route.legs[0].start_address);
                    $("#detalleDestino").append(route.legs[0].end_address);
                    $("#detalleKms").append(route.legs[0].distance.text);
                    // For each route, display summary information.
{#                    for (var i = 0; i < route.legs.length; i++) {
                        console.log(route.legs[0])
                        summaryPanel.innerHTML += '<b>Ruta elegida: </b><br> desde ';
                        summaryPanel.innerHTML += route.legs[i].start_address + ' hasta ';
                        summaryPanel.innerHTML += route.legs[i].end_address + '<br>';
                        summaryPanel.innerHTML += route.legs[i].distance.text + '<br><br>';
                        summaryPanel.innerHTML += route.legs[i].start_location.lat() + '<br><br>';
                        summaryPanel.innerHTML += route.legs[i].start_location.lng() + '<br><br>';
                        summaryPanel.innerHTML += route.legs[i].end_location.lat() + '<br><br>';
                        summaryPanel.innerHTML += route.legs[i].end_location.lng() + '<br><br>';
                    }#}
                } else {
                    window.alert('La direccion requerida fallo: ' + status);
                }
            });
        }

    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAjPmpXtKE4ObWzFSEZ3PyTqHmHRohog6A&callback=initMap">
    </script>
{% endblock %}
